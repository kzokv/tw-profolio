# Local Runbook

## Start services

- Infra: `docker compose -f infra/docker/docker-compose.yml up -d`
- API: `npm run dev -w apps/api`
- Web: `npm run dev -w apps/web`

## Required env

- `WEB_PORT`
- `API_PORT`
- `DB_PORT`
- `REDIS_PORT`
- `AUTH_MODE`
- `PERSISTENCE_BACKEND`
- `DB_URL` (optional override)
- `REDIS_URL` (optional override)
- `ALLOWED_ORIGINS` (comma-separated CORS allowlist)
- `RATE_LIMIT_WINDOW_MS`
- `RATE_LIMIT_MAX_MUTATIONS`

## Notes

- Use `AUTH_MODE=dev_bypass` for local development only.
- In production-like environments, use `AUTH_MODE=oauth`.
- Recompute history is explicit and audited through preview/confirm APIs.
- For local tests without DB/Redis, set `PERSISTENCE_BACKEND=memory`.

## Settings drawer behavior

- Open settings from the top-right avatar button.
- Drawer URL state is `/?drawer=settings` for direct linking.
- Drawer now has two tabs: `General` and `Fee Profiles`.
- `Save Settings` persists locale/cost basis/poll interval and fee profile configuration atomically via `/settings/full`.
- Fee profiles support account fallback + per-security overrides.
- New fee profile IDs are generated by the system (UUID).
- `Discard Changes` reverts unsaved edits to last persisted values without closing drawer.
- Closing with unsaved edits shows a warning before discard.

## Localization behavior

- Supported UI locales: `en` and `zh-TW`.
- After saving locale, all visible web wording switches to the selected language, including settings tabs and dialogs.
- If language appears stale, refresh settings by reopening drawer or reloading page and verify `/settings` response.

## Tooltip behavior

- Settings terms and key financial terms on dashboard/forms provide hover/focus tooltips.
- FIFO/LIFO include detailed explanatory tooltip content in settings.
- Tooltips are keyboard accessible through focus on the info icon triggers.
